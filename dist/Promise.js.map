{"version":3,"sources":["../src/Promise.js"],"names":["React","Component","Promise","props","state","pending","error","result","skipped","onInitAndUpdate","__unmounted","args","prevProps","prevState","promise","Error","skip","executePromise","setState","options","_backedOptions","mixin","replayed","then","catch","render","replay","bind"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\n\nexport class Promise extends Component {\n\n    constructor (props) {\n        super (props)\n        this.state = {\n            pending: null,\n            error: null,\n            result: null,\n            skipped: null\n        }\n    }\n\n    componentDidMount () {\n        this.onInitAndUpdate()\n    }\n\n    componentWillUnmount () {\n        this.__unmounted = true\n    }\n\n    setState (...args) {\n        if(!this.__unmounted)\n            super.setState(...args)\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        if(prevProps !== this.props)\n            this.onInitAndUpdate()\n    }\n\n    onInitAndUpdate () {\n        if(!this.props.promise) {\n            throw new Error('Promise function is missing.')\n        }\n        if(!this.props.skip || (typeof this.props.skip === 'function' && !this.props.skip(this.props))) {\n            this.executePromise()\n        } else {\n            this.setState({ pending: false, skipped: true })\n        }\n    }\n\n    executePromise (options = (this._backedOptions || this.props), { mixin = false, replayed = false } = {}) {\n        const { promise, then } = this.props\n        this.setState({ pending: true, skipped: false })\n        this._backedOptions = mixin ? { ...options, ...this._backedOptions } : options\n        promise(options, { replayed })\n            .then(result => {\n                if(typeof then === 'function') {\n                    result = then(result)\n                }\n                this.setState({ result, error: null })\n                return result\n            })\n            .catch(error => {\n                this.setState({ error, result: null })\n            })\n            .then(() => {\n                this.setState({\n                    pending: false\n                })\n            })\n    }\n\n    render () {\n        const { pending } = this.state\n        const { render } = this.props\n\n        if(pending === null) {\n            return null\n        }\n\n        return render({\n            ...this.state,\n            replay: (options, mixin = true) => this.executePromise.bind(this)(options, { mixin, replayed: true })\n        })\n\n    }\n}"],"file":"Promise.js"}