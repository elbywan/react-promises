{"version":3,"sources":["../src/Promise.js"],"names":["React","Component","PromiseComponent","props","state","pending","error","result","skipped","setInitialState","__promiseComponent","onInitAndUpdate","__unmounted","args","prevProps","prevState","promise","Error","skip","executePromise","setState","initialValue","then","options","mixin","replayed","_backedOptions","catch","render","replay","bind","displayName"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\n\nexport class PromiseComponent extends Component {\n\n    constructor (props) {\n        super (props)\n        this.state = {\n            pending: true,\n            error: null,\n            result: null,\n            skipped: false\n        }\n        this.setInitialState(props)\n        this.__promiseComponent = true\n    }\n\n    componentDidMount () {\n        this.onInitAndUpdate()\n    }\n\n    componentWillUnmount () {\n        this.__unmounted = true\n    }\n\n    setState (...args) {\n        if(!this.__unmounted)\n            super.setState(...args)\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        if(prevProps !== this.props)\n            this.onInitAndUpdate()\n    }\n\n    onInitAndUpdate () {\n        if(!this.props.promise) {\n            throw new Error('Promise function is missing.')\n        }\n        if(!this.props.skip || (typeof this.props.skip === 'function' && !this.props.skip(this.props))) {\n            this.executePromise()\n        } else {\n            this.setState({ pending: false, skipped: true })\n        }\n    }\n\n    setInitialState (props) {\n        const { initialValue, then } = props\n        if(!initialValue)\n            return\n        this.state.pending = false\n        if(typeof then === 'function') {\n            this.state.result = then(initialValue)\n        } else {\n            this.state.result = initialValue\n        }\n    }\n\n    executePromise (options = this.props, { mixin = false, replayed = false } = {}) {\n        const { promise, then } = this.props\n        const { pending, skipped } = this.state\n        if(!pending || skipped) {\n            this.setState({ pending: true, skipped: false })\n        }\n        this._backedOptions = mixin ? { ...this._backedOptions, ...options } : options\n        return promise(mixin ? this._backedOptions : options, { replayed })\n            .then(result => {\n                if(typeof then === 'function') {\n                    result = then(result)\n                }\n                this.setState({ result, error: null, pending: false })\n                return result\n            })\n            .catch(error => {\n                this.setState({ error, result: null, pending: false })\n            })\n    }\n\n    render () {\n        const { pending } = this.state\n        const { render } = this.props\n\n        if(pending === null) {\n            return null\n        }\n\n        return render({\n            ...this.state,\n            replay: (options, mixin = true) => this.executePromise.bind(this)(options, { mixin, replayed: true })\n        })\n\n    }\n}\nPromiseComponent.displayName = 'PromiseComponent'"],"file":"Promise.js"}