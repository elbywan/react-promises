{"version":3,"file":"index.js","sources":["../src/Promise.js","../src/withPromise.js"],"sourcesContent":["import React, { Component } from 'react'\n\nexport class Promise extends Component {\n\n    constructor (props) {\n        super (props)\n        this.state = {\n            pending: null,\n            error: null,\n            result: null,\n            skipped: null\n        }\n    }\n\n    componentDidMount () {\n        this.onInitAndUpdate()\n    }\n\n    componentWillUnmount () {\n        this.__unmounted = true\n    }\n\n    setState (...args) {\n        if(!this.__unmounted)\n            super.setState(...args)\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        if(prevProps !== this.props)\n            this.onInitAndUpdate()\n    }\n\n    onInitAndUpdate () {\n        if(!this.props.promise) {\n            throw new Error('Promise function is missing.')\n        }\n        if(!this.props.skip || (typeof this.props.skip === 'function' && !this.props.skip(this.props))) {\n            this.performPromise()\n        } else {\n            this.setState({ pending: false, skipped: true })\n        }\n    }\n\n    performPromise (options = (this._backedOptions || this.props), mixin = false) {\n        const { promise } = this.props\n        this.setState({ pending: true, skipped: false })\n        this._backedOptions = mixin ? { ...options, ...this._backedOptions } : options\n        promise(options)\n            .then(result => {\n                if(typeof this.props.then === 'function') {\n                    result = this.props.then(result)\n                }\n                this.setState({ result })\n                return result\n            })\n            .catch(error => {\n                this.setState({ error })\n            })\n            .then(() => {\n                this.setState({\n                    pending: false\n                })\n            })\n    }\n\n    render () {\n        const { pending } = this.state\n        const { render } = this.props\n\n        if(pending === null) {\n            return null\n        }\n\n        return render({\n            ...this.state,\n            replay: (options, mixin = true) => this.performPromise.bind(this)(options, mixin)\n        })\n\n    }\n}","import React, { Component } from 'react'\nimport { Promise } from './Promise'\n\nexport function withPromise({\n    skip,\n    promise,\n    then,\n    props = _ => _\n}) {\n    return function (Component) {\n        return function (ownProps) {\n            const children = promiseProps => {\n                const mixedProps = {\n                    ...ownProps,\n                    ...props(promiseProps, ownProps)\n                }\n                return (\n                    <Component { ...mixedProps } />\n                )\n            }\n            return (\n                <Promise\n                    skip={skip}\n                    promise={promise}\n                    render={children}\n                    then={then}\n                    { ...ownProps }\n                />\n            )\n        }\n    }\n}"],"names":["Promise","props","state","pending","error","result","skipped","Component","onInitAndUpdate","__unmounted","args","this","prevProps","prevState","promise","Error","skip","performPromise","setState","options","_backedOptions","mixin","then","_this2","catch","render","replay","_this3","bind","_","ownProps","React","promiseProps","mixedProps"],"mappings":"kvDAEaA,EAAb,uBAEiBC,8IACFA,KACFC,MAAQ,CACTC,QAAS,KACTC,MAAO,KACPC,OAAQ,KACRC,QAAS,8PARQC,oEAahBC,sEAIAC,aAAc,kEAGVC,2BAAAA,kBACLC,KAAKF,8EACaC,+CAGNE,EAAWC,GACxBD,IAAcD,KAAKV,OAClBU,KAAKH,gEAILG,KAAKV,MAAMa,cACL,IAAIC,MAAM,iCAEhBJ,KAAKV,MAAMe,MAAoC,mBAApBL,KAAKV,MAAMe,OAAwBL,KAAKV,MAAMe,KAAKL,KAAKV,YAC9EgB,sBAEAC,SAAS,CAAEf,SAAS,EAAOG,SAAS,wDAIjCa,yDAAWR,KAAKS,gBAAkBT,KAAKV,MAAQoB,0DACnDP,EAAYH,KAAKV,MAAjBa,aACHI,SAAS,CAAEf,SAAS,EAAMG,SAAS,SACnCc,eAAiBC,OAAaF,EAAYR,KAAKS,gBAAmBD,EACvEL,EAAQK,GACHG,KAAK,SAAAjB,SAC4B,mBAApBkB,EAAKtB,MAAMqB,OACjBjB,EAASkB,EAAKtB,MAAMqB,KAAKjB,IAE7BkB,EAAKL,SAAS,CAAEb,OAAAA,IACTA,IAEVmB,MAAM,SAAApB,GACHmB,EAAKL,SAAS,CAAEd,MAAAA,MAEnBkB,KAAK,WACFC,EAAKL,SAAS,CACVf,SAAS,kDAMbA,EAAYQ,KAAKT,MAAjBC,QACAsB,EAAWd,KAAKV,MAAhBwB,cAEO,OAAZtB,EACQ,KAGJsB,OACAd,KAAKT,OACRwB,OAAQ,SAACP,OAASE,oEAAiBM,EAAKV,eAAeW,KAAKD,EAAzBA,CAA+BR,EAASE,yCAzEvF,6BCCO,gBACHL,IAAAA,KACAF,IAAAA,QACAQ,IAAAA,SACArB,MAAAA,aAAQ,SAAA4B,UAAKA,YAEN,SAAUtB,UACN,SAAUuB,UAWTC,gBAAC/B,KACGgB,KAAMA,EACNF,QAASA,EACTW,OAbS,SAAAO,OACPC,OACCH,EACA7B,EAAM+B,EAAcF,WAGvBC,gBAACxB,EAAe0B,IAQhBX,KAAMA,GACDQ"}