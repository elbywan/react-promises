{"version":3,"file":"react-promises.umd.min.js","sources":["../../src/Promise.js","../../src/withPromise.js"],"sourcesContent":["import React, { Component } from 'react'\n\nexport class Promise extends Component {\n\n    constructor (props) {\n        super (props)\n        this.state = {\n            pending: null,\n            error: null,\n            result: null,\n            skipped: null\n        }\n    }\n\n    componentDidMount () {\n        this.onInitAndUpdate()\n    }\n\n    componentWillUnmount () {\n        this.__unmounted = true\n    }\n\n    setState (...args) {\n        if(!this.__unmounted)\n            super.setState(...args)\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        if(prevProps !== this.props)\n            this.onInitAndUpdate()\n    }\n\n    onInitAndUpdate () {\n        if(!this.props.promise) {\n            throw new Error('Promise function is missing.')\n        }\n        if(!this.props.skip || (typeof this.props.skip === 'function' && !this.props.skip(this.props))) {\n            this.executePromise()\n        } else {\n            this.setState({ pending: false, skipped: true })\n        }\n    }\n\n    executePromise (options = (this._backedOptions || this.props), { mixin = false, replayed = false } = {}) {\n        const { promise, then } = this.props\n        this.setState({ pending: true, skipped: false })\n        this._backedOptions = mixin ? { ...options, ...this._backedOptions } : options\n        promise(options, { replayed })\n            .then(result => {\n                if(typeof then === 'function') {\n                    result = this.props.then(result)\n                }\n                this.setState({ result, error: null })\n                return result\n            })\n            .catch(error => {\n                this.setState({ error, result: null })\n            })\n            .then(() => {\n                this.setState({\n                    pending: false\n                })\n            })\n    }\n\n    render () {\n        const { pending } = this.state\n        const { render } = this.props\n\n        if(pending === null) {\n            return null\n        }\n\n        return render({\n            ...this.state,\n            replay: (options, mixin = true) => this.executePromise.bind(this)(options, { mixin, replayed: true })\n        })\n\n    }\n}","import React, { Component } from 'react'\nimport { Promise } from './Promise'\n\nexport function withPromise({\n    skip,\n    promise,\n    then,\n    props = _ => _\n}) {\n    return function (Component) {\n        return function (ownProps) {\n            const children = promiseProps => {\n                const mixedProps = {\n                    ...ownProps,\n                    ...props(promiseProps, ownProps)\n                }\n                return (\n                    <Component { ...mixedProps } />\n                )\n            }\n            return (\n                <Promise\n                    skip={skip}\n                    promise={promise}\n                    render={children}\n                    then={then}\n                    { ...ownProps }\n                />\n            )\n        }\n    }\n}"],"names":["Promise","props","state","pending","error","result","skipped","Component","onInitAndUpdate","__unmounted","args","this","prevProps","prevState","promise","Error","skip","executePromise","setState","options","_backedOptions","mixin","replayed","then","_this2","catch","render","replay","_this3","bind","_","ownProps","React","promiseProps","mixedProps"],"mappings":"kvDAEaA,EAAb,uBAEiBC,8IACFA,KACFC,MAAQ,CACTC,QAAS,KACTC,MAAO,KACPC,OAAQ,KACRC,QAAS,8PARQC,oEAahBC,sEAIAC,aAAc,kEAGVC,2BAAAA,kBACLC,KAAKF,8EACaC,+CAGNE,EAAWC,GACxBD,IAAcD,KAAKV,OAClBU,KAAKH,gEAILG,KAAKV,MAAMa,cACL,IAAIC,MAAM,iCAEhBJ,KAAKV,MAAMe,MAAoC,mBAApBL,KAAKV,MAAMe,OAAwBL,KAAKV,MAAMe,KAAKL,KAAKV,YAC9EgB,sBAEAC,SAAS,CAAEf,SAAS,EAAOG,SAAS,wDAIjCa,yDAAWR,KAAKS,gBAAkBT,KAAKV,+DAA8C,OAApCoB,MAAAA,oBAAeC,SAAAA,kBAClDX,KAAKV,MAAvBa,IAAAA,QAASS,IAAAA,UACZL,SAAS,CAAEf,SAAS,EAAMG,SAAS,SACnCc,eAAiBC,OAAaF,EAAYR,KAAKS,gBAAmBD,EACvEL,EAAQK,EAAS,CAAEG,SAAAA,IACdC,KAAK,SAAAlB,SACiB,mBAATkB,IACNlB,EAASmB,EAAKvB,MAAMsB,KAAKlB,IAE7BmB,EAAKN,SAAS,CAAEb,OAAAA,EAAQD,MAAO,OACxBC,IAEVoB,MAAM,SAAArB,GACHoB,EAAKN,SAAS,CAAEd,MAAAA,EAAOC,OAAQ,SAElCkB,KAAK,WACFC,EAAKN,SAAS,CACVf,SAAS,kDAMbA,EAAYQ,KAAKT,MAAjBC,QACAuB,EAAWf,KAAKV,MAAhByB,cAEO,OAAZvB,EACQ,KAGJuB,OACAf,KAAKT,OACRyB,OAAQ,SAACR,OAASE,oEAAiBO,EAAKX,eAAeY,KAAKD,EAAzBA,CAA+BT,EAAS,CAAEE,MAAAA,EAAOC,UAAU,0CAzE1G,6BCCO,gBACHN,IAAAA,KACAF,IAAAA,QACAS,IAAAA,SACAtB,MAAAA,aAAQ,SAAA6B,UAAKA,YAEN,SAAUvB,UACN,SAAUwB,UAWTC,gBAAChC,KACGgB,KAAMA,EACNF,QAASA,EACTY,OAbS,SAAAO,OACPC,OACCH,EACA9B,EAAMgC,EAAcF,WAGvBC,gBAACzB,EAAe2B,IAQhBX,KAAMA,GACDQ"}