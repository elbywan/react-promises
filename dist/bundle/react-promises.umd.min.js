!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e["react-promises"]={},e.React)}(this,function(e,i){"use strict";var s="default"in i?i.default:i;function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function h(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return o}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var d=function(e){function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=l(this,p(o).call(this,e))).state={pending:!0,error:null,result:null,skipped:!1},t.setInitialState(e),t.__promiseComponent=!0,t}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(o,i.Component),t=o,(n=[{key:"componentDidMount",value:function(){this.onInitAndUpdate()}},{key:"componentWillUnmount",value:function(){this.__unmounted=!0}},{key:"setState",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.__unmounted||(e=f(p(o.prototype),"setState",this)).call.apply(e,[this].concat(n))}},{key:"componentDidUpdate",value:function(e,t){e!==this.props&&this.onInitAndUpdate()}},{key:"onInitAndUpdate",value:function(){if(!this.props.promise)throw new Error("Promise function is missing.");!this.props.skip||"function"==typeof this.props.skip&&!this.props.skip(this.props)?this.executePromise():this.setState({pending:!1,skipped:!0})}},{key:"setInitialState",value:function(e){var t=e.initialValue,n=e.then;t&&(this.state.pending=!1,this.state.result="function"==typeof n?n(t):t)}},{key:"executePromise",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.props,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.mixin,o=void 0!==r&&r,i=n.replayed,u=void 0!==i&&i,s=this.props,c=s.promise,p=s.then,a=this.state,l=a.pending,f=a.skipped;return l&&!f||this.setState({pending:!0,skipped:!1}),this._backedOptions=o?h({},this._backedOptions,e):e,c(o?this._backedOptions:e,{replayed:u}).then(function(e){return"function"==typeof p&&(e=p(e)),t.setState({result:e,error:null,pending:!1}),e}).catch(function(e){t.setState({error:e,result:null,pending:!1})})}},{key:"render",value:function(){var n=this,e=this.state.pending,t=this.props.render;return null===e?null:t(h({},this.state,{replay:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return n.executePromise.bind(n)(e,{mixin:t,replayed:!0})}}))}}])&&u(t.prototype,n),r&&u(t,r),o}();var o={componentWillUnmount:!(d.displayName="PromiseComponent")},t=Symbol.for("react.forward_ref"),y=function(e,r){var t,s,n,o=[];return(t=e,s=function(e,t,n){return Promise.resolve(r(t,n)).then(function(e){o.push(e)})},new Promise(function(r,o){var i=t[Symbol.iterator](),u=0;!function t(e){var n=i.next();n.done?r(e):Promise.all([e,n.value]).then(function(e){t(s(e[0],e[1],u++))}).catch(o)}(n)})).then(function(){return o})},m=function(e){return e.props&&e.props.children?e.props.children:e.children?e.children:void 0},v=function(e){return e.type||e.nodeName},b=function(e){return e.type&&e.type.$$typeof===t};var P=function(t,n,r){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:o;return new Promise(function(e,f){var h=function(){try{return n.apply(void 0,arguments)}catch(e){f(e)}};(function p(a,l){if(Array.isArray(a))return Promise.all(a.map(function(e){return p(e,l)}));if(!a)return Promise.resolve();if("string"==typeof a||"number"==typeof a)return h(a,null,l),Promise.resolve();if(a.type&&(a.type._context&&(a.type._context._currentValue=a.props.value),a.type.Provider&&a.type.Consumer)){var e=a.props.children(a.type.Provider._context._currentValue);return p(e,l)}return v(a)?new Promise(function(o){var e,t,n=function(n,e,t,r){return Promise.resolve(h(a,e,t,r)).then(function(e){if(!1!==e){var t=function e(t){return t&&"function"==typeof t.render?e(t.render()):t}(n());if(t)return Array.isArray(t)?y(t,function(e){return e?p(e,r):Promise.resolve()}).then(o,f).catch(f):p(t,r).then(o,f).catch(f)}}).catch(f)};if("function"==typeof v(a)||b(a)){var r=v(a),i=Object.assign({},r.defaultProps,(t=a).props||t.attributes,{children:m(a)});if(b(a))n(function(){return a.type.render(i)},null,l,l).then(o);else if((e=r).prototype&&(e.prototype.render||e.prototype.isReactComponent||e.prototype.isPureReactComponent)){var u=new r(i,l);if(Object.defineProperty(u,"props",{value:u.props||i}),u.context=u.context||l,u.state=u.state||null,u.setState=function(e){"function"==typeof e&&(e=e(u.state,u.props,u.context)),u.state=Object.assign({},u.state,e)},r.getDerivedStateFromProps){var s=r.getDerivedStateFromProps(u.props,u.state);null!==s&&(u.state=Object.assign({},u.state,s))}else u.UNSAFE_componentWillMount?u.UNSAFE_componentWillMount():u.componentWillMount&&u.componentWillMount();var c=u.getChildContext?Object.assign({},l,u.getChildContext()):l;n(function(){return u.render(u.props,u.state)},u,l,c).then(function(){d.componentWillUnmount&&u.componentWillUnmount&&u.componentWillUnmount()}).then(o)}else n(function(){return r(i,l)},null,l,l).then(o)}else n(function(){return m(a)},null,l,l).then(o)}):a.containerInfo&&a.children&&a.children.props&&Array.isArray(a.children.props.children)?Promise.all(a.children.props.children.map(function(e){return p(e,l)})):Promise.resolve()})(t,r).then(e,f)})};e.PromiseComponent=d,e.withPromise=function(e){var t=e.skip,o=e.promise,i=e.then,n=e.props,u=void 0===n?function(e){return e}:n;return function(r){return function(n){return s.createElement(d,c({skip:t,promise:o,render:function(e){var t=h({},n,u(e,n));return s.createElement(r,t)},then:i},n))}}},e.resolveAll=function(e){var t,n,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.before,u=o.after;return P(e,(n=(t={before:i,after:u}).before,r=t.after,function(e,t){return t&&!0===t.__promiseComponent&&"function"==typeof t.executePromise?(n&&n(t),t.executePromise().then(function(e){return r&&r(e,t),!0})):Promise.resolve(!0)}))},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-promises.umd.min.js.map
